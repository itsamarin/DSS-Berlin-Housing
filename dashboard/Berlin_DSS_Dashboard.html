<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Berlin Housing DSS - Interactive Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 50%, #4c1d95 100%);
            background-attachment: fixed;
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            -webkit-box-decoration-break: clone;
            box-decoration-break: clone;
            margin-bottom: 0.5rem;
            font-weight: 800;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #e0e7ff;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab {
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        .tab:nth-child(1):hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .tab:nth-child(2):hover {
            background: rgba(16, 185, 129, 0.3);
            border-color: #10b981;
        }

        .tab:nth-child(3):hover {
            background: rgba(245, 158, 11, 0.3);
            border-color: #f59e0b;
        }

        .tab.active {
            color: #0f172a;
        }

        .tab:nth-child(1).active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .tab:nth-child(2).active {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .tab:nth-child(3).active {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.15) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card:nth-child(1) {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(59, 130, 246, 0.15) 100%);
            border-left-color: #3b82f6;
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3) 0%, rgba(16, 185, 129, 0.15) 100%);
            border-left-color: #10b981;
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(245, 158, 11, 0.15) 100%);
            border-left-color: #f59e0b;
        }

        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(239, 68, 68, 0.15) 100%);
            border-left-color: #ef4444;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #fbbf24;
            display: block;
            margin-bottom: 0.5rem;
        }

        .stat-card:nth-child(1) .stat-number {
            color: #60a5fa;
        }

        .stat-card:nth-child(2) .stat-number {
            color: #34d399;
        }

        .stat-card:nth-child(3) .stat-number {
            color: #fbbf24;
        }

        .stat-card:nth-child(4) .stat-number {
            color: #f87171;
        }

        .stat-label {
            font-size: 1rem;
            color: #cbd5e1;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.08);
            padding: 2rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: #fbbf24;
            text-align: center;
            font-weight: 600;
        }

        .filters {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(16, 185, 129, 0.15));
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .filter-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 0.75rem 1rem;
            align-items: center;
        }

        .filter-group label {
            color: #cbd5e1;
            font-weight: 600;
            white-space: nowrap;
            text-align: right;
        }

        .filter-group select,
        .filter-group input {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 2px solid #60a5fa;
            background: rgba(255, 255, 255, 0.1);
            color: #f1f5f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #34d399;
            box-shadow: 0 0 0 3px rgba(52, 211, 153, 0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(16, 185, 129, 0.3));
            color: #60a5fa;
            font-weight: 600;
        }

        tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .recommendation-card {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(147, 51, 234, 0.1) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border-left: 4px solid #ec4899;
            transition: all 0.3s ease;
        }

        .recommendation-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 24px rgba(236, 72, 153, 0.3);
        }

        .recommendation-card h3 {
            color: #f9a8d4;
            margin-bottom: 0.5rem;
        }

        .recommendation-card .score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .recommendation-card .details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .two-column-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .column-section {
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 1200px) {
            .two-column-grid {
                grid-template-columns: 1fr;
            }
        }

        .detail-item {
            color: #cbd5e1;
        }

        .detail-item strong {
            color: #f1f5f9;
        }

        button {
            transition: all 0.3s ease;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
            appearance: none;
        }

        button:hover {
            background: #fbbf24 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        /* iOS-specific fixes for inputs */
        input, select {
            -webkit-appearance: none;
            appearance: none;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8rem;
            }

            .filter-group {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .filter-group label {
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Berlin Housing Decision Support System</h1>
            <p class="subtitle">About Integrated Decision Support System (DSS) for Accommodation Matching and Occupancy Optimization in Berlin</p>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview', event)">Overview Dashboard</div>
            <div class="tab" onclick="switchTab('tenant', event)">Tenant View</div>
            <div class="tab" onclick="switchTab('landlord', event)">Landlord Analytics</div>
        </div>

        <!-- Overview Dashboard -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number">2,319</span>
                    <span class="stat-label">Total Listings</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">2,000</span>
                    <span class="stat-label">Active Tenants</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">4.2/5</span>
                    <span class="stat-label">Avg. Satisfaction</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">62.5%</span>
                    <span class="stat-label">Verification Rate</span>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Listings by District</h3>
                    <canvas id="districtChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Room Type Distribution</h3>
                    <canvas id="roomTypeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Price vs Satisfaction</h3>
                    <canvas id="priceVsSatisfactionChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Monthly Booking Trends</h3>
                    <canvas id="bookingTrendsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tenant View (Combined Smart Matching + Browse All Listings) -->
        <div id="tenant" class="tab-content">
            <div class="two-column-grid">
                <!-- Left Column: Smart Matching -->
                <div class="column-section">
                    <h2 style="margin-bottom: 1.5rem; color: #f9a8d4;">Find Your Perfect Accommodation</h2>

                    <!-- Smart Matching Section -->
                    <div class="filters" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(147, 51, 234, 0.15)); border-left: 4px solid #ec4899;">
                        <h3 style="color: #f9a8d4; margin-bottom: 1rem;">üéØ AI-Powered Smart Matching</h3>
                        <p style="color: #e0e7ff; margin-bottom: 1rem; font-size: 0.95rem;">Get personalized recommendations based on your preferences</p>
                        <div class="filter-group">
                            <label>Budget (‚Ç¨):</label>
                            <input type="number" id="matchBudget" placeholder="1000" value="1000">

                            <label>Preferred District:</label>
                            <select id="matchDistrict">
                                <option value="Mitte">Mitte</option>
                                <option value="Kreuzberg">Kreuzberg</option>
                                <option value="Friedrichshain">Friedrichshain</option>
                                <option value="Charlottenburg">Charlottenburg</option>
                                <option value="Prenzlauer Berg">Prenzlauer Berg</option>
                            </select>

                            <label>Min Rating:</label>
                            <input type="number" id="matchRating" min="1" max="5" step="0.1" value="4.0">
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="generateRecommendations()" style="padding: 0.75rem 2rem; background: linear-gradient(135deg, #ec4899, #db2777); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Find Best Matches</button>
                        </div>
                    </div>

                    <h3 style="color: #f9a8d4; margin: 2rem 0 1rem 0;">Top Recommendations</h3>
                    <div id="recommendationsContainer"></div>
                </div>

                <!-- Right Column: Browse All Listings -->
                <div class="column-section">
                    <h2 style="margin-bottom: 1.5rem; color: #60a5fa;">Browse All Listings</h2>
                    <div class="filters" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(16, 185, 129, 0.15));">
                        <h3 style="color: #60a5fa; margin-bottom: 1rem;">üîç Filter Search</h3>
                        <div class="filter-group">
                            <label>District:</label>
                            <select id="districtFilter">
                                <option value="all">All Districts</option>
                                <option value="Mitte">Mitte</option>
                                <option value="Kreuzberg">Kreuzberg</option>
                                <option value="Friedrichshain">Friedrichshain</option>
                                <option value="Charlottenburg">Charlottenburg</option>
                                <option value="Prenzlauer Berg">Prenzlauer Berg</option>
                            </select>

                            <label>Max Price (‚Ç¨):</label>
                            <input type="number" id="priceFilter" placeholder="e.g., 1000" min="0">

                            <label>Room Type:</label>
                            <select id="roomTypeFilter">
                                <option value="all">All Types</option>
                                <option value="Private">Private Room</option>
                                <option value="Entire">Entire Place</option>
                                <option value="Shared">Shared Room</option>
                            </select>

                            <label>Min Rating:</label>
                            <input type="number" id="ratingFilter" placeholder="e.g., 4.0" min="1" max="5" step="0.1">

                            <label>Max Distance (km):</label>
                            <input type="number" id="distanceFilter" placeholder="e.g., 5" min="0" step="0.1">

                            <label>Verified Only:</label>
                            <select id="verifiedFilter">
                                <option value="all">All Properties</option>
                                <option value="verified">Verified Only</option>
                                <option value="unverified">Unverified Only</option>
                            </select>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="populateTenantTable()" style="padding: 0.75rem 2rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Search Listings</button>
                        </div>
                    </div>

                    <div style="overflow-x: auto; margin-top: 1.5rem;">
                        <table id="tenantTable">
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>District</th>
                                    <th>Type</th>
                                    <th>Price (‚Ç¨/month)</th>
                                    <th>Rating</th>
                                    <th>Distance to Center</th>
                                    <th>Verified</th>
                                </tr>
                            </thead>
                            <tbody id="tenantTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Landlord Analytics -->
        <div id="landlord" class="tab-content">
            <h2 style="margin-bottom: 1.5rem; color: #f59e0b;">Landlord Performance Analytics</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number">‚Ç¨1,245</span>
                    <span class="stat-label">Avg. Monthly Revenue</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">78%</span>
                    <span class="stat-label">Occupancy Rate</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">4.3/5</span>
                    <span class="stat-label">Avg. Guest Rating</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">12.5</span>
                    <span class="stat-label">Avg. Days to Book</span>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Revenue by District</h3>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Occupancy Trends</h3>
                    <canvas id="occupancyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Average Price by Room Type</h3>
                    <canvas id="priceByRoomTypeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Guest Ratings Distribution</h3>
                    <canvas id="ratingsDistributionChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Booking Response Time</h3>
                    <canvas id="responseTimeChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Seasonal Revenue Forecast</h3>
                    <canvas id="revenueForecastChart"></canvas>
                </div>
            </div>

            <!-- Landlord Tenant Matching Section -->
            <h2 style="margin: 3rem 0 1.5rem 0; color: #f59e0b;">Find Your Perfect Tenant & Browse All Applicants</h2>

            <div class="two-column-grid">
                <!-- Left Column: Smart Tenant Matching -->
                <div class="column-section">
                    <h3 style="margin-bottom: 1.5rem; color: #f9a8d4;">AI-Powered Tenant Matching</h3>

                    <!-- Smart Matching Section -->
                    <div class="filters" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.15)); border-left: 4px solid #f59e0b;">
                        <h3 style="color: #fbbf24; margin-bottom: 1rem;">üéØ Find Ideal Tenants for Your Property</h3>
                        <p style="color: #e0e7ff; margin-bottom: 1rem; font-size: 0.95rem;">Advanced AI algorithm analyzes tenant compatibility, financial stability, location preferences, and historical data to find your perfect match</p>
                        <div class="filter-group">
                            <label>Your Property District:</label>
                            <select id="landlordPropertyDistrict">
                                <option value="Mitte">Mitte</option>
                                <option value="Kreuzberg">Kreuzberg</option>
                                <option value="Friedrichshain">Friedrichshain</option>
                                <option value="Charlottenburg">Charlottenburg</option>
                                <option value="Prenzlauer Berg">Prenzlauer Berg</option>
                            </select>

                            <label>Your Asking Price (‚Ç¨):</label>
                            <input type="number" id="landlordPrice" placeholder="1200" value="1200">

                            <label>Property Type:</label>
                            <select id="landlordPropertyType">
                                <option value="Entire">Entire Place</option>
                                <option value="Private">Private Room</option>
                                <option value="Shared">Shared Room</option>
                            </select>

                            <label>Min Tenant Budget (‚Ç¨):</label>
                            <input type="number" id="landlordMinBudget" placeholder="1000" value="1000">

                            <label>Preferred Tenant Type:</label>
                            <select id="landlordTenantOccupation">
                                <option value="all">All Occupations</option>
                                <option value="Professional">Professional</option>
                                <option value="Student">Student</option>
                                <option value="Researcher">Researcher</option>
                                <option value="Engineer">Engineer</option>
                            </select>

                            <label>Priority Factors:</label>
                            <select id="landlordPriority">
                                <option value="balanced">Balanced (All Factors)</option>
                                <option value="financial">Financial Stability</option>
                                <option value="location">Location Match</option>
                                <option value="verification">Verification Priority</option>
                            </select>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button onclick="generateTenantRecommendations()" style="padding: 0.75rem 2rem; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Find Best Tenant Matches</button>
                        </div>
                    </div>

                    <h3 style="color: #fbbf24; margin: 2rem 0 1rem 0;">Top Tenant Recommendations</h3>
                    <div id="tenantRecommendationsContainer"></div>
                </div>

                <!-- Right Column: Browse All Tenants -->
                <div class="column-section">
                    <h3 style="margin-bottom: 1.5rem; color: #60a5fa;">Browse All Tenant Applicants</h3>
                    <div class="filters" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(16, 185, 129, 0.15));">
                        <h3 style="color: #60a5fa; margin-bottom: 1rem;">üîç Advanced Filter Search</h3>
                        <p style="color: #cbd5e1; margin-bottom: 1rem; font-size: 0.9rem;">Use advanced filters to find tenants matching your specific requirements</p>
                        <div class="filter-group">
                            <label>Preferred District:</label>
                            <select id="tenantDistrictFilter">
                                <option value="all">All Districts</option>
                                <option value="Mitte">Mitte</option>
                                <option value="Kreuzberg">Kreuzberg</option>
                                <option value="Friedrichshain">Friedrichshain</option>
                                <option value="Charlottenburg">Charlottenburg</option>
                                <option value="Prenzlauer Berg">Prenzlauer Berg</option>
                            </select>

                            <label>Min Budget (‚Ç¨):</label>
                            <input type="number" id="tenantMinBudgetFilter" placeholder="e.g., 800" min="0">

                            <label>Max Budget (‚Ç¨):</label>
                            <input type="number" id="tenantMaxBudgetFilter" placeholder="e.g., 1500" min="0">

                            <label>Room Type Preference:</label>
                            <select id="tenantRoomTypeFilter">
                                <option value="all">All Types</option>
                                <option value="Entire">Entire Place</option>
                                <option value="Private">Private Room</option>
                                <option value="Shared">Shared Room</option>
                            </select>

                            <label>Occupation:</label>
                            <select id="tenantOccupationFilter">
                                <option value="all">All Occupations</option>
                                <option value="Student">Student</option>
                                <option value="Professional">Professional</option>
                                <option value="Researcher">Researcher</option>
                                <option value="Engineer">Engineer</option>
                                <option value="Designer">Designer</option>
                                <option value="Teacher">Teacher</option>
                                <option value="Developer">Developer</option>
                            </select>

                            <label>Verified Tenants:</label>
                            <select id="tenantVerifiedFilter">
                                <option value="all">All Tenants</option>
                                <option value="verified">Verified Only</option>
                                <option value="unverified">Unverified Only</option>
                            </select>

                            <label>Sort By:</label>
                            <select id="tenantSortFilter">
                                <option value="budget-desc">Budget (High to Low)</option>
                                <option value="budget-asc">Budget (Low to High)</option>
                                <option value="verified">Verification Status</option>
                                <option value="name">Name (A-Z)</option>
                            </select>
                        </div>
                        <div style="text-align: center; margin-top: 1rem; display: flex; gap: 1rem; justify-content: center;">
                            <button onclick="populateLandlordTenantTable()" style="padding: 0.75rem 2rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Search Tenants</button>
                            <button onclick="resetTenantFilters()" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #6b7280, #4b5563); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Reset Filters</button>
                        </div>
                    </div>

                    <div style="overflow-x: auto; margin-top: 1.5rem;">
                        <table id="landlordTenantTable">
                            <thead>
                                <tr>
                                    <th>Tenant Name</th>
                                    <th>Preferred District</th>
                                    <th>Budget (‚Ç¨/month)</th>
                                    <th>Income (‚Ç¨/month)</th>
                                    <th>Room Type</th>
                                    <th>Occupation</th>
                                    <th>Verified</th>
                                </tr>
                            </thead>
                            <tbody id="landlordTenantTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Lazy loading for sample listings - generate in batches
        let sampleListings = [];
        let isDataLoaded = false;

        function generateListings() {
            const districts = ["Mitte", "Kreuzberg", "Friedrichshain", "Charlottenburg", "Prenzlauer Berg"];
            const types = ["Entire", "Private", "Shared"];
            const adjectives = ["Cozy", "Modern", "Spacious", "Charming", "Luxury", "Budget", "Central", "Artistic",
                               "Bright", "Elegant", "Classic", "Downtown", "Affordable", "Quiet", "Beautiful",
                               "Minimalist", "Designer", "Furnished", "Sunny", "Premium", "Urban", "Stylish",
                               "Contemporary", "Traditional", "Renovated", "Historic", "Trendy", "Comfortable"];
            const propertyTypes = ["Apartment", "Studio", "Loft", "Room", "Penthouse", "Flat", "Suite", "Space"];

            const listings = [];

            // Reduced initial dataset from 1000 to 500 for faster loading
            for (let i = 1; i <= 500; i++) {
                const district = districts[Math.floor(Math.random() * districts.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                const propertyType = propertyTypes[Math.floor(Math.random() * propertyTypes.length)];

                // Price based on type
                let basePrice = type === "Entire" ? 1200 : (type === "Private" ? 750 : 500);
                const price = basePrice + Math.floor(Math.random() * 1000) - 200;

                // Rating between 3.5 and 5.0
                const rating = (3.5 + Math.random() * 1.5).toFixed(1);

                // Distance between 1 and 7 km
                const distance = (1 + Math.random() * 6).toFixed(1);

                // 80% verified
                const verified = Math.random() > 0.2;

                listings.push({
                    id: i,
                    name: `${adjective} ${propertyType} ${district}`,
                    district: district,
                    type: type,
                    price: Math.max(400, price),
                    rating: parseFloat(rating),
                    distance: parseFloat(distance),
                    verified: verified
                });
            }

            return listings;
        }

        // Load data asynchronously to not block page render
        function loadData() {
            if (!isDataLoaded) {
                setTimeout(() => {
                    sampleListings = generateListings();
                    isDataLoaded = true;
                }, 100);
            }
        }

        // Debounce utility function to prevent excessive filter calls
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Track which tabs have been initialized
        let initializedTabs = { overview: false, tenant: false, landlord: false };

        // Tab Switching
        function switchTab(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            // Lazy load tab content
            if (tabName === 'tenant' && !initializedTabs.tenant) {
                populateTenantTable();
                generateRecommendations();
                initializedTabs.tenant = true;
            } else if (tabName === 'landlord' && !initializedTabs.landlord) {
                initializeLandlordCharts();
                initializedTabs.landlord = true;
            } else if (tabName === 'overview' && !initializedTabs.overview) {
                initializeOverviewCharts();
                initializedTabs.overview = true;
            }
        }

        // Initialize Charts
        const chartColors = {
            primary: '#f59e0b',
            secondary: '#fbbf24',
            tertiary: '#fb923c',
            background: 'rgba(245, 158, 11, 0.2)'
        };

        // Initialize Overview Charts (lazy loaded)
        function initializeOverviewCharts() {
            // District Chart
            const districtCtx = document.getElementById('districtChart').getContext('2d');
            new Chart(districtCtx, {
            type: 'bar',
            data: {
                labels: ['Mitte', 'Kreuzberg', 'Friedrichshain', 'Charlottenburg', 'Prenzlauer Berg', 'Neuk√∂lln'],
                datasets: [{
                    label: 'Number of Listings',
                    data: [450, 380, 295, 340, 310, 280],
                    backgroundColor: chartColors.primary,
                    borderColor: chartColors.secondary,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });

        // Room Type Chart
        const roomTypeCtx = document.getElementById('roomTypeChart').getContext('2d');
        new Chart(roomTypeCtx, {
            type: 'doughnut',
            data: {
                labels: ['Entire Place', 'Private Room', 'Shared Room'],
                datasets: [{
                    data: [1200, 950, 169],
                    backgroundColor: [
                        '#3b82f6',  // Blue for Entire Place
                        '#10b981',  // Green for Private Room
                        '#f59e0b'   // Orange for Shared Room
                    ],
                    borderWidth: 2,
                    borderColor: '#0f172a'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                }
            }
        });

        // Price vs Satisfaction Scatter
        const priceVsSatisfactionCtx = document.getElementById('priceVsSatisfactionChart').getContext('2d');
        new Chart(priceVsSatisfactionCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Properties',
                    data: [
                        { x: 800, y: 4.2 }, { x: 1200, y: 4.5 }, { x: 950, y: 4.1 },
                        { x: 1500, y: 4.7 }, { x: 650, y: 3.8 }, { x: 1100, y: 4.4 },
                        { x: 2000, y: 4.9 }, { x: 750, y: 4.0 }, { x: 1350, y: 4.6 }
                    ],
                    backgroundColor: chartColors.primary,
                    borderColor: chartColors.secondary,
                    borderWidth: 2,
                    pointRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: {
                        title: { display: true, text: 'Satisfaction Rating', color: '#f1f5f9' },
                        ticks: { color: '#f1f5f9' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: {
                        title: { display: true, text: 'Price (‚Ç¨)', color: '#f1f5f9' },
                        ticks: { color: '#f1f5f9' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    }
                }
            }
        });

        // Booking Trends Line Chart
        const bookingTrendsCtx = document.getElementById('bookingTrendsChart').getContext('2d');
        new Chart(bookingTrendsCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Bookings',
                    data: [850, 920, 1100, 1250, 1400, 1550, 1650, 1600, 1450, 1300, 1050, 900],
                    borderColor: chartColors.primary,
                    backgroundColor: chartColors.background,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });
        }

        // Initialize Landlord Charts (lazy loaded)
        function initializeLandlordCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        new Chart(revenueCtx, {
            type: 'bar',
            data: {
                labels: ['Mitte', 'Kreuzberg', 'Friedrichshain', 'Charlottenburg', 'Prenzlauer Berg'],
                datasets: [{
                    label: 'Avg Monthly Revenue (‚Ç¨)',
                    data: [1450, 1200, 1100, 1350, 1250],
                    backgroundColor: chartColors.primary,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });

        // Occupancy Chart
        const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
        new Chart(occupancyCtx, {
            type: 'line',
            data: {
                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                datasets: [{
                    label: 'Occupancy Rate (%)',
                    data: [72, 78, 82, 76],
                    borderColor: chartColors.primary,
                    backgroundColor: chartColors.background,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 100,
                        ticks: { color: '#f1f5f9' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' }
                    },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });

        // Average Price by Room Type Chart
        const priceByRoomTypeCtx = document.getElementById('priceByRoomTypeChart').getContext('2d');
        new Chart(priceByRoomTypeCtx, {
            type: 'bar',
            data: {
                labels: ['Entire Place', 'Private Room', 'Shared Room'],
                datasets: [{
                    label: 'Average Price (‚Ç¨/month)',
                    data: [1350, 850, 550],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.7)',   // Blue
                        'rgba(16, 185, 129, 0.7)',   // Green
                        'rgba(245, 158, 11, 0.7)'    // Orange
                    ],
                    borderColor: [
                        '#3b82f6',
                        '#10b981',
                        '#f59e0b'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: {
                        ticks: { color: '#f1f5f9' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        beginAtZero: true
                    },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });

        // Guest Ratings Distribution Chart
        const ratingsDistributionCtx = document.getElementById('ratingsDistributionChart').getContext('2d');
        new Chart(ratingsDistributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['5 Stars', '4-4.9 Stars', '3-3.9 Stars', 'Below 3'],
                datasets: [{
                    data: [245, 512, 198, 45],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.8)',   // Green
                        'rgba(59, 130, 246, 0.8)',   // Blue
                        'rgba(245, 158, 11, 0.8)',   // Orange
                        'rgba(239, 68, 68, 0.8)'     // Red
                    ],
                    borderColor: '#0f172a',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#f1f5f9', padding: 15 }
                    }
                }
            }
        });

        // Booking Response Time Chart
        const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
        new Chart(responseTimeCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Avg Response Time (hours)',
                    data: [3.2, 2.8, 4.1, 3.5, 2.9, 5.2, 4.8],
                    borderColor: '#ec4899',
                    backgroundColor: 'rgba(236, 72, 153, 0.2)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointBackgroundColor: '#ec4899'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { labels: { color: '#f1f5f9' } }
                },
                scales: {
                    y: {
                        ticks: { color: '#f1f5f9' },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        beginAtZero: true
                    },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });

        // Seasonal Revenue Forecast Chart
        const revenueForecastCtx = document.getElementById('revenueForecastChart').getContext('2d');
        new Chart(revenueForecastCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [
                    {
                        label: 'Actual Revenue (‚Ç¨)',
                        data: [28500, 27800, 32000, 35200, 38500, 42000, 45000, 43500, 39000, 36500, 33000, 30000],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Forecast Revenue (‚Ç¨)',
                        data: [null, null, null, null, null, null, null, null, 39500, 37000, 34000, 31500],
                        borderColor: '#fbbf24',
                        backgroundColor: 'rgba(251, 191, 36, 0.1)',
                        borderDash: [5, 5],
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        labels: { color: '#f1f5f9' },
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        ticks: {
                            color: '#f1f5f9',
                            callback: function(value) {
                                return '‚Ç¨' + (value / 1000) + 'k';
                            }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        beginAtZero: true
                    },
                    x: { ticks: { color: '#f1f5f9' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        });
        }

        // Pagination state
        let currentPage = 1;
        const itemsPerPage = 50;

        // Populate Tenant Table with pagination
        function populateTenantTable() {
            if (!isDataLoaded) {
                loadData();
                setTimeout(populateTenantTable, 200);
                return;
            }

            const tbody = document.getElementById('tenantTableBody');
            tbody.innerHTML = '';

            // Get filter values
            const districtFilter = document.getElementById('districtFilter').value;
            const priceFilter = parseFloat(document.getElementById('priceFilter').value) || Infinity;
            const roomTypeFilter = document.getElementById('roomTypeFilter').value;
            const ratingFilter = parseFloat(document.getElementById('ratingFilter').value) || 0;
            const distanceFilter = parseFloat(document.getElementById('distanceFilter').value) || Infinity;
            const verifiedFilter = document.getElementById('verifiedFilter').value;

            // Filter listings
            const filteredListings = sampleListings.filter(listing => {
                const matchesDistrict = districtFilter === 'all' || listing.district === districtFilter;
                const matchesPrice = listing.price <= priceFilter;
                const matchesRoomType = roomTypeFilter === 'all' || listing.type === roomTypeFilter;
                const matchesRating = listing.rating >= ratingFilter;
                const matchesDistance = listing.distance <= distanceFilter;
                const matchesVerified = verifiedFilter === 'all' ||
                                       (verifiedFilter === 'verified' && listing.verified) ||
                                       (verifiedFilter === 'unverified' && !listing.verified);

                return matchesDistrict && matchesPrice && matchesRoomType && matchesRating && matchesDistance && matchesVerified;
            });

            // Pagination
            const totalPages = Math.ceil(filteredListings.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedListings = filteredListings.slice(startIndex, endIndex);

            // Display filtered results
            paginatedListings.forEach(listing => {
                const row = `
                    <tr>
                        <td>${listing.name}</td>
                        <td>${listing.district}</td>
                        <td>${listing.type}</td>
                        <td>‚Ç¨${listing.price}</td>
                        <td>${listing.rating}/5</td>
                        <td>${listing.distance} km</td>
                        <td>${listing.verified ? '‚úì Yes' : '‚úó No'}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Show message if no results
            if (filteredListings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem; color: #cbd5e1;">No accommodations match your filters. Try adjusting your criteria.</td></tr>';
            }

            // Update pagination controls
            updatePaginationControls(filteredListings.length, totalPages);
        }

        // Update pagination controls
        function updatePaginationControls(totalItems, totalPages) {
            let paginationDiv = document.getElementById('paginationControls');
            if (!paginationDiv) {
                paginationDiv = document.createElement('div');
                paginationDiv.id = 'paginationControls';
                paginationDiv.style.cssText = 'margin-top: 1.5rem; text-align: center; display: flex; justify-content: center; align-items: center; gap: 1rem;';
                document.getElementById('tenantTable').parentElement.appendChild(paginationDiv);
            }

            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }

            let html = `<div style="color: #cbd5e1;">Page ${currentPage} of ${totalPages} (${totalItems} results)</div>`;
            html += '<div style="display: flex; gap: 0.5rem;">';

            if (currentPage > 1) {
                html += `<button onclick="changePage(${currentPage - 1})" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; cursor: pointer;">Previous</button>`;
            }

            if (currentPage < totalPages) {
                html += `<button onclick="changePage(${currentPage + 1})" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; cursor: pointer;">Next</button>`;
            }

            html += '</div>';
            paginationDiv.innerHTML = html;
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            populateTenantTable();
        }

        // Generate sample tenants data
        let sampleTenants = [];
        let isTenantDataLoaded = false;

        function generateTenants() {
            const districts = ["Mitte", "Kreuzberg", "Friedrichshain", "Charlottenburg", "Prenzlauer Berg"];
            const types = ["Entire", "Private", "Shared"];
            const firstNames = ["Anna", "Max", "Sophie", "Leon", "Emma", "Noah", "Mia", "Felix", "Lena", "Paul",
                               "Laura", "Ben", "Marie", "Jonas", "Julia", "Lukas", "Hannah", "Tim", "Sarah", "David"];
            const lastNames = ["M√ºller", "Schmidt", "Schneider", "Fischer", "Weber", "Meyer", "Wagner", "Becker",
                              "Schulz", "Hoffmann", "Koch", "Richter", "Klein", "Wolf", "Schr√∂der", "Neumann"];
            const occupations = ["Student", "Professional", "Researcher", "Engineer", "Designer", "Teacher",
                                "Consultant", "Developer", "Manager", "Artist"];

            const tenants = [];

            for (let i = 1; i <= 300; i++) {
                const district = districts[Math.floor(Math.random() * districts.length)];
                const type = types[Math.floor(Math.random() * types.length)];
                const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                const occupation = occupations[Math.floor(Math.random() * occupations.length)];

                // Budget based on occupation and type preference
                let baseBudget = occupation === "Student" ? 600 : 1000;
                if (type === "Entire") baseBudget += 400;
                else if (type === "Private") baseBudget += 200;

                const budget = baseBudget + Math.floor(Math.random() * 500);

                // 85% verified
                const verified = Math.random() > 0.15;

                tenants.push({
                    id: i,
                    name: `${firstName} ${lastName}`,
                    district: district,
                    type: type,
                    budget: Math.max(500, budget),
                    occupation: occupation,
                    verified: verified,
                    income: budget * 3 // Rule: income should be 3x rent
                });
            }

            return tenants;
        }

        function loadTenantData() {
            if (!isTenantDataLoaded) {
                setTimeout(() => {
                    sampleTenants = generateTenants();
                    isTenantDataLoaded = true;
                }, 100);
            }
        }

        // Generate Recommendations (for Tenants)
        function generateRecommendations() {
            if (!isDataLoaded) {
                loadData();
                setTimeout(generateRecommendations, 200);
                return;
            }

            const budget = parseFloat(document.getElementById('matchBudget').value) || 1000;
            const district = document.getElementById('matchDistrict').value;
            const minRating = parseFloat(document.getElementById('matchRating').value) || 4.0;

            const scored = sampleListings.map(listing => {
                let score = 0;

                // Price Affordability (30%)
                const priceScore = listing.price <= budget ? 30 : Math.max(0, 30 - ((listing.price - budget) / budget * 30));
                score += priceScore;

                // Location Proximity (20%)
                const locationScore = listing.district === district ? 20 : 10;
                score += locationScore;

                // Guest Satisfaction (30%)
                const satisfactionScore = (listing.rating / 5) * 30;
                score += satisfactionScore;

                // Verification Status (20%)
                const verificationScore = listing.verified ? 20 : 0;
                score += verificationScore;

                return { ...listing, matchScore: Math.round(score) };
            }).filter(l => l.rating >= minRating).sort((a, b) => b.matchScore - a.matchScore).slice(0, 5);

            const container = document.getElementById('recommendationsContainer');
            container.innerHTML = '';

            scored.forEach((listing, index) => {
                const card = `
                    <div class="recommendation-card">
                        <h3>#${index + 1} ${listing.name}</h3>
                        <div class="score">Match Score: ${listing.matchScore}/100</div>
                        <div class="details">
                            <div class="detail-item"><strong>District:</strong> ${listing.district}</div>
                            <div class="detail-item"><strong>Price:</strong> ‚Ç¨${listing.price}/month</div>
                            <div class="detail-item"><strong>Rating:</strong> ${listing.rating}/5</div>
                            <div class="detail-item"><strong>Type:</strong> ${listing.type}</div>
                            <div class="detail-item"><strong>Distance:</strong> ${listing.distance} km</div>
                            <div class="detail-item"><strong>Verified:</strong> ${listing.verified ? 'Yes' : 'No'}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Enhanced AI-Powered Generate Tenant Recommendations (for Landlords)
        function generateTenantRecommendations() {
            if (!isTenantDataLoaded) {
                loadTenantData();
                setTimeout(generateTenantRecommendations, 200);
                return;
            }

            const propertyDistrict = document.getElementById('landlordPropertyDistrict').value;
            const propertyPrice = parseFloat(document.getElementById('landlordPrice').value) || 1200;
            const propertyType = document.getElementById('landlordPropertyType').value;
            const minBudget = parseFloat(document.getElementById('landlordMinBudget').value) || 1000;
            const preferredOccupation = document.getElementById('landlordTenantOccupation').value;
            const priority = document.getElementById('landlordPriority').value;

            // Define weight factors based on priority
            let weights = {
                budget: 30,
                location: 20,
                type: 15,
                verification: 15,
                income: 15,
                occupation: 5
            };

            // Adjust weights based on priority selection
            if (priority === 'financial') {
                weights = { budget: 40, location: 15, type: 10, verification: 10, income: 20, occupation: 5 };
            } else if (priority === 'location') {
                weights = { budget: 25, location: 35, type: 15, verification: 10, income: 10, occupation: 5 };
            } else if (priority === 'verification') {
                weights = { budget: 20, location: 15, type: 15, verification: 35, income: 10, occupation: 5 };
            }

            const scored = sampleTenants.map(tenant => {
                let score = 0;
                let scoreBreakdown = {};

                // Budget Match (AI considers affordability range)
                let budgetScore = 0;
                if (tenant.budget >= propertyPrice) {
                    const affordabilityRatio = tenant.budget / propertyPrice;
                    if (affordabilityRatio >= 1 && affordabilityRatio <= 1.3) {
                        budgetScore = weights.budget; // Perfect match
                    } else if (affordabilityRatio > 1.3) {
                        budgetScore = weights.budget * 0.85; // Can afford but might look for better
                    }
                } else {
                    budgetScore = Math.max(0, weights.budget * (tenant.budget / propertyPrice));
                }
                score += budgetScore;
                scoreBreakdown.budget = budgetScore.toFixed(1);

                // Location Match (AI considers neighborhood preference)
                const locationScore = tenant.district === propertyDistrict ? weights.location : weights.location * 0.5;
                score += locationScore;
                scoreBreakdown.location = locationScore.toFixed(1);

                // Property Type Match
                const typeScore = tenant.type === propertyType ? weights.type : weights.type * 0.4;
                score += typeScore;
                scoreBreakdown.type = typeScore.toFixed(1);

                // Verification Status (AI prioritizes verified tenants)
                const verificationScore = tenant.verified ? weights.verification : weights.verification * 0.3;
                score += verificationScore;
                scoreBreakdown.verification = verificationScore.toFixed(1);

                // Income Stability (AI checks 3x rule: income should be 3x rent)
                let incomeScore = 0;
                const incomeRatio = tenant.income / propertyPrice;
                if (incomeRatio >= 3) {
                    incomeScore = weights.income; // Meets standard requirement
                } else if (incomeRatio >= 2.5) {
                    incomeScore = weights.income * 0.8; // Close to requirement
                } else {
                    incomeScore = weights.income * 0.4; // Below standard
                }
                score += incomeScore;
                scoreBreakdown.income = incomeScore.toFixed(1);

                // Occupation Preference Match
                let occupationScore = weights.occupation;
                if (preferredOccupation !== 'all') {
                    occupationScore = tenant.occupation === preferredOccupation ? weights.occupation : weights.occupation * 0.3;
                }
                score += occupationScore;
                scoreBreakdown.occupation = occupationScore.toFixed(1);

                // AI Compatibility Factor (bonus points for ideal combinations)
                let compatibilityBonus = 0;
                if (tenant.verified && incomeRatio >= 3 && tenant.budget >= propertyPrice) {
                    compatibilityBonus = 5; // High reliability bonus
                }
                score += compatibilityBonus;
                scoreBreakdown.compatibility = compatibilityBonus.toFixed(1);

                // Cap score at 100
                score = Math.min(score, 100);

                return {
                    ...tenant,
                    matchScore: Math.round(score),
                    scoreBreakdown: scoreBreakdown,
                    incomeRatio: incomeRatio.toFixed(1),
                    affordabilityRatio: (tenant.budget / propertyPrice).toFixed(2)
                };
            }).filter(t => t.budget >= minBudget).sort((a, b) => b.matchScore - a.matchScore).slice(0, 5);

            const container = document.getElementById('tenantRecommendationsContainer');
            container.innerHTML = '';

            if (scored.length === 0) {
                container.innerHTML = '<p style="color: #cbd5e1; text-align: center; padding: 2rem;">No tenants match your criteria. Try adjusting your requirements.</p>';
                return;
            }

            scored.forEach((tenant, index) => {
                const matchQuality = tenant.matchScore >= 80 ? 'üåü Excellent Match' :
                                   tenant.matchScore >= 65 ? '‚ú® Good Match' :
                                   '‚≠ê Fair Match';

                const incomeIndicator = tenant.incomeRatio >= 3 ? '‚úì Meets 3x rule' :
                                       tenant.incomeRatio >= 2.5 ? '~ Close to 3x rule' :
                                       '‚úó Below 3x rule';

                const card = `
                    <div class="recommendation-card" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(251, 191, 36, 0.1) 100%); border-left-color: #f59e0b;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h3 style="color: #fbbf24; margin: 0;">#${index + 1} ${tenant.name}</h3>
                            <span style="color: #fbbf24; font-size: 0.9rem; font-weight: bold;">${matchQuality}</span>
                        </div>
                        <div class="score">AI Match Score: ${tenant.matchScore}/100</div>
                        <div style="color: #cbd5e1; font-size: 0.85rem; margin-bottom: 1rem;">
                            <strong>Score Breakdown:</strong> Budget(${tenant.scoreBreakdown.budget}) + Location(${tenant.scoreBreakdown.location}) + Type(${tenant.scoreBreakdown.type}) + Verification(${tenant.scoreBreakdown.verification}) + Income(${tenant.scoreBreakdown.income}) + Occupation(${tenant.scoreBreakdown.occupation})${parseFloat(tenant.scoreBreakdown.compatibility) > 0 ? ' + Compatibility('+tenant.scoreBreakdown.compatibility+')' : ''}
                        </div>
                        <div class="details">
                            <div class="detail-item"><strong>Occupation:</strong> ${tenant.occupation}</div>
                            <div class="detail-item"><strong>Budget:</strong> ‚Ç¨${tenant.budget}/month (${tenant.affordabilityRatio}x your price)</div>
                            <div class="detail-item"><strong>Income:</strong> ‚Ç¨${tenant.income}/month (${incomeIndicator})</div>
                            <div class="detail-item"><strong>Preferred District:</strong> ${tenant.district}</div>
                            <div class="detail-item"><strong>Preferred Type:</strong> ${tenant.type}</div>
                            <div class="detail-item"><strong>Verified:</strong> ${tenant.verified ? '‚úì Yes' : '‚úó No'}</div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Populate Landlord Tenant Table (Browse All Tenants)
        let currentTenantPage = 1;
        const tenantsPerPage = 50;

        function populateLandlordTenantTable() {
            if (!isTenantDataLoaded) {
                loadTenantData();
                setTimeout(populateLandlordTenantTable, 200);
                return;
            }

            const tbody = document.getElementById('landlordTenantTableBody');
            tbody.innerHTML = '';

            // Get filter values
            const districtFilter = document.getElementById('tenantDistrictFilter').value;
            const minBudgetFilter = parseFloat(document.getElementById('tenantMinBudgetFilter').value) || 0;
            const maxBudgetFilter = parseFloat(document.getElementById('tenantMaxBudgetFilter').value) || Infinity;
            const roomTypeFilter = document.getElementById('tenantRoomTypeFilter').value;
            const occupationFilter = document.getElementById('tenantOccupationFilter').value;
            const verifiedFilter = document.getElementById('tenantVerifiedFilter').value;
            const sortFilter = document.getElementById('tenantSortFilter').value;

            // Filter tenants
            let filteredTenants = sampleTenants.filter(tenant => {
                const matchesDistrict = districtFilter === 'all' || tenant.district === districtFilter;
                const matchesMinBudget = tenant.budget >= minBudgetFilter;
                const matchesMaxBudget = tenant.budget <= maxBudgetFilter;
                const matchesRoomType = roomTypeFilter === 'all' || tenant.type === roomTypeFilter;
                const matchesOccupation = occupationFilter === 'all' || tenant.occupation === occupationFilter;
                const matchesVerified = verifiedFilter === 'all' ||
                                       (verifiedFilter === 'verified' && tenant.verified) ||
                                       (verifiedFilter === 'unverified' && !tenant.verified);

                return matchesDistrict && matchesMinBudget && matchesMaxBudget && matchesRoomType && matchesOccupation && matchesVerified;
            });

            // Sort tenants based on selected criteria
            if (sortFilter === 'budget-desc') {
                filteredTenants.sort((a, b) => b.budget - a.budget);
            } else if (sortFilter === 'budget-asc') {
                filteredTenants.sort((a, b) => a.budget - b.budget);
            } else if (sortFilter === 'verified') {
                filteredTenants.sort((a, b) => (b.verified ? 1 : 0) - (a.verified ? 1 : 0));
            } else if (sortFilter === 'name') {
                filteredTenants.sort((a, b) => a.name.localeCompare(b.name));
            }

            // Pagination
            const totalPages = Math.ceil(filteredTenants.length / tenantsPerPage);
            const startIndex = (currentTenantPage - 1) * tenantsPerPage;
            const endIndex = startIndex + tenantsPerPage;
            const paginatedTenants = filteredTenants.slice(startIndex, endIndex);

            // Display filtered results
            paginatedTenants.forEach(tenant => {
                const verifiedBadge = tenant.verified ?
                    '<span style="color: #10b981;">‚úì Yes</span>' :
                    '<span style="color: #ef4444;">‚úó No</span>';

                const incomeToRentRatio = (tenant.income / tenant.budget).toFixed(1);
                const incomeColor = incomeToRentRatio >= 3 ? '#10b981' : incomeToRentRatio >= 2.5 ? '#f59e0b' : '#ef4444';

                const row = `
                    <tr>
                        <td>${tenant.name}</td>
                        <td>${tenant.district}</td>
                        <td>‚Ç¨${tenant.budget}</td>
                        <td style="color: ${incomeColor};">‚Ç¨${tenant.income} (${incomeToRentRatio}x)</td>
                        <td>${tenant.type}</td>
                        <td>${tenant.occupation}</td>
                        <td>${verifiedBadge}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Show message if no results
            if (filteredTenants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem; color: #cbd5e1;">No tenants match your filters. Try adjusting your criteria.</td></tr>';
            }

            // Update pagination controls
            updateTenantPaginationControls(filteredTenants.length, totalPages);
        }

        // Reset Tenant Filters
        function resetTenantFilters() {
            document.getElementById('tenantDistrictFilter').value = 'all';
            document.getElementById('tenantMinBudgetFilter').value = '';
            document.getElementById('tenantMaxBudgetFilter').value = '';
            document.getElementById('tenantRoomTypeFilter').value = 'all';
            document.getElementById('tenantOccupationFilter').value = 'all';
            document.getElementById('tenantVerifiedFilter').value = 'all';
            document.getElementById('tenantSortFilter').value = 'budget-desc';
            currentTenantPage = 1;
            populateLandlordTenantTable();
        }

        // Update tenant pagination controls
        function updateTenantPaginationControls(totalItems, totalPages) {
            let paginationDiv = document.getElementById('tenantPaginationControls');
            if (!paginationDiv) {
                paginationDiv = document.createElement('div');
                paginationDiv.id = 'tenantPaginationControls';
                paginationDiv.style.cssText = 'margin-top: 1.5rem; text-align: center; display: flex; justify-content: center; align-items: center; gap: 1rem;';
                document.getElementById('landlordTenantTable').parentElement.appendChild(paginationDiv);
            }

            if (totalPages <= 1) {
                paginationDiv.innerHTML = '';
                return;
            }

            let html = `<div style="color: #cbd5e1;">Page ${currentTenantPage} of ${totalPages} (${totalItems} tenants)</div>`;
            html += '<div style="display: flex; gap: 0.5rem;">';

            if (currentTenantPage > 1) {
                html += `<button onclick="changeTenantPage(${currentTenantPage - 1})" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; cursor: pointer;">Previous</button>`;
            }

            if (currentTenantPage < totalPages) {
                html += `<button onclick="changeTenantPage(${currentTenantPage + 1})" style="padding: 0.5rem 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 8px; cursor: pointer;">Next</button>`;
            }

            html += '</div>';
            paginationDiv.innerHTML = html;
        }

        // Change tenant page
        function changeTenantPage(page) {
            currentTenantPage = page;
            populateLandlordTenantTable();
        }

        // Create debounced versions of filter functions
        const debouncedPopulateTenantTable = debounce(populateTenantTable, 300);
        const debouncedGenerateRecommendations = debounce(generateRecommendations, 300);

        // Attach event listeners to filters with debouncing for input events
        document.getElementById('districtFilter').addEventListener('change', () => {
            currentPage = 1; // Reset to first page
            populateTenantTable();
        });
        document.getElementById('priceFilter').addEventListener('input', () => {
            currentPage = 1;
            debouncedPopulateTenantTable();
        });
        document.getElementById('roomTypeFilter').addEventListener('change', () => {
            currentPage = 1;
            populateTenantTable();
        });
        document.getElementById('ratingFilter').addEventListener('input', () => {
            currentPage = 1;
            debouncedPopulateTenantTable();
        });
        document.getElementById('distanceFilter').addEventListener('input', () => {
            currentPage = 1;
            debouncedPopulateTenantTable();
        });
        document.getElementById('verifiedFilter').addEventListener('change', () => {
            currentPage = 1;
            populateTenantTable();
        });

        // Attach event listeners to matching filters with debouncing
        document.getElementById('matchBudget').addEventListener('input', debouncedGenerateRecommendations);
        document.getElementById('matchDistrict').addEventListener('change', generateRecommendations);
        document.getElementById('matchRating').addEventListener('input', debouncedGenerateRecommendations);

        // Attach event listeners to landlord tenant matching filters
        const debouncedGenerateTenantRecommendations = debounce(generateTenantRecommendations, 300);
        const debouncedPopulateLandlordTenantTable = debounce(populateLandlordTenantTable, 300);

        document.getElementById('landlordPropertyDistrict').addEventListener('change', generateTenantRecommendations);
        document.getElementById('landlordPrice').addEventListener('input', debouncedGenerateTenantRecommendations);
        document.getElementById('landlordPropertyType').addEventListener('change', generateTenantRecommendations);
        document.getElementById('landlordMinBudget').addEventListener('input', debouncedGenerateTenantRecommendations);
        document.getElementById('landlordTenantOccupation').addEventListener('change', generateTenantRecommendations);
        document.getElementById('landlordPriority').addEventListener('change', generateTenantRecommendations);

        // Attach event listeners to landlord tenant browse filters
        document.getElementById('tenantDistrictFilter').addEventListener('change', () => {
            currentTenantPage = 1;
            populateLandlordTenantTable();
        });
        document.getElementById('tenantMinBudgetFilter').addEventListener('input', () => {
            currentTenantPage = 1;
            debouncedPopulateLandlordTenantTable();
        });
        document.getElementById('tenantMaxBudgetFilter').addEventListener('input', () => {
            currentTenantPage = 1;
            debouncedPopulateLandlordTenantTable();
        });
        document.getElementById('tenantRoomTypeFilter').addEventListener('change', () => {
            currentTenantPage = 1;
            populateLandlordTenantTable();
        });
        document.getElementById('tenantOccupationFilter').addEventListener('change', () => {
            currentTenantPage = 1;
            populateLandlordTenantTable();
        });
        document.getElementById('tenantVerifiedFilter').addEventListener('change', () => {
            currentTenantPage = 1;
            populateLandlordTenantTable();
        });
        document.getElementById('tenantSortFilter').addEventListener('change', () => {
            currentTenantPage = 1;
            populateLandlordTenantTable();
        });

        // Initialize data loading and defer heavy operations
        function initializePage() {
            loadData();
            loadTenantData();
            // Initialize overview charts since it's the default active tab
            setTimeout(() => {
                initializeOverviewCharts();
                initializedTabs.overview = true;
            }, 200);
        }

        // Support both DOMContentLoaded and load events for better iOS compatibility
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            // DOM already loaded (common on iOS)
            initializePage();
        }
    </script>
</body>
</html>
